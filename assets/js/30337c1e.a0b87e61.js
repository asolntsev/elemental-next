"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[76413],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var r=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=r.createContext({}),u=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return r.createElement(s.Provider,{value:t},e.children)},c="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},g=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=u(n),g=a,h=c["".concat(s,".").concat(g)]||c[g]||d[g]||o;return n?r.createElement(h,i(i({ref:t},p),{},{components:n})):r.createElement(h,i({ref:t},p))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=g;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[c]="string"==typeof e?e:a,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}g.displayName="MDXCreateElement"},58416:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>d,frontMatter:()=>o,metadata:()=>l,toc:()=>u});var r=n(87462),a=(n(67294),n(3905));const o={hide_table_of_contents:!0,publish_date:new Date("2014-06-10T00:00:00.000Z"),level:3,language:"ruby"},i=void 0,l={unversionedId:"logging/ruby",id:"logging/ruby",title:"ruby",description:"A Solution",source:"@site/tips/54-logging/ruby.md",sourceDirName:"54-logging",slug:"/logging/ruby",permalink:"/tips/logging/ruby",draft:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/tips/54-logging/ruby.md",tags:[],version:"current",lastUpdatedBy:"Diego Molina",lastUpdatedAt:1705761381,formattedLastUpdatedAt:"Jan 20, 2024",frontMatter:{hide_table_of_contents:!0,publish_date:"2014-06-10T00:00:00.000Z",level:3,language:"ruby"}},s={},u=[{value:"A Solution",id:"a-solution",level:2},{value:"Example",id:"example",level:2},{value:"Expected Behavior",id:"expected-behavior",level:2},{value:"Summary",id:"summary",level:2},{value:"About The Author",id:"about-the-author",level:2}],p={toc:u},c="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(c,(0,r.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"a-solution"},"A Solution"),(0,a.kt)("p",null,"By accessing what we want through the ",(0,a.kt)("a",{parentName:"p",href:"https://code.google.com/p/selenium/wiki/JsonWireProtocol"},"WebDriver Wire Protocol"),", we can get at the logs we want in a browser\nagnostic way that also gets us the information in real time."),(0,a.kt)("h2",{id:"example"},"Example"),(0,a.kt)("p",null,"First, we'll need to ",(0,a.kt)("a",{parentName:"p",href:"https://www.selenium.dev/downloads/"},"download a copy of Selenium Server")," and launch it."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"},"java -jar selenium-server-4.8.2.jar standalone\n")),(0,a.kt)("p",null,"Next, we'll want to create a mechanism to access the Selenium Server logs through the WebDriver Wire Protocol via an\nHTTP library -- filtering out the logs we don't want and return the most recent one."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ruby"},'# filename: logger.rb\n\nrequire \'rest-client\'\nrequire \'json\'\n\nclass Logger\n\n  def initialize(session_id)\n    @session_id = session_id\n  end\n\n  def latest\n    parse(fetch).last\n  end\n\n  private\n\n  def fetch\n    RestClient.post(\n      "http://127.0.0.1:4444/wd/hub/session/#{@session_id}/log",\n      { "type" => "client" }.to_json,\n      content_type: :json,\n      accept: :json\n    )\n  end\n\n  def parse(input)\n    logs = JSON.parse(input)\n    messages = []\n    logs["value"].each do |entry|\n      msg = entry["message"]\n      unless msg.include? "session:" or\n        msg.include? "fetching logs" or\n          msg.include? "execute script"\n            messages << msg.scan(/handle(.*)$/)[-1][-1]\n      end\n    end\n    messages\n  end\n\nend\n')),(0,a.kt)("p",null,"A couple of things to note."),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"session_id")," will come from the instance of Selenium that gets created in our test (via Selenium Grid). To see\nyour sessions, navigate to the instance in your web browser (http://localhost:4444/) and then click Sessions in the\nside panel. This session ID maps to a URI endpoint on the Selenium Server that we use to get the logging payload\nwith an HTTP POST (see ",(0,a.kt)("inlineCode",{parentName:"p"},"fetch"),"). We are then taking that payload (which comes back as a JSON object in String form)\nand parsing it into JSON, iterating through it, grabbing the relevant bits we want (see ",(0,a.kt)("inlineCode",{parentName:"p"},"parse"),"). When that's all\ndone, we return the last entry found (see ",(0,a.kt)("inlineCode",{parentName:"p"},"latest"),")."),(0,a.kt)("p",null,"And of ",(0,a.kt)("a",{parentName:"p",href:"https://code.google.com/p/selenium/wiki/Logging#Log_Types"},"all the available log types we can access"),", we're grabbing the client logs\n(which will give us the real time actions taken in our test)."),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"NOTE: Each time we access the logs, it will clear the cache of logs. So the next time we access them, it will\nonly return new entries.")),(0,a.kt)("p",null,"Now we're ready to wire up our test to use the Selenium Server, access our logger class, and output the latest\nlog entries after each Selenium action."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ruby"},"# filename: log_test.rb\n\nrequire 'selenium-webdriver'\nrequire 'rspec/expectations'\ninclude RSpec::Matchers\nrequire_relative 'logger'\n\ndef setup\n  @driver = Selenium::WebDriver.for :remote, url: 'http://127.0.0.1:4444/wd/hub'\n  @logger = Logger.new(@driver.session_id)\nend\n\ndef teardown\n  @driver.quit\nend\n\ndef run\n  setup\n  yield\n  teardown\nend\n\nrun do\n  @driver.get 'https://the-internet.herokuapp.com'\n  puts @logger.latest\n  @driver.find_elements(css: 'a').last.click\n  puts @logger.latest\nend\n")),(0,a.kt)("p",null,"When we run this (e.g., ",(0,a.kt)("inlineCode",{parentName:"p"},"ruby log_test.rb"),"), here's what we should see."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-sh"}," Done: [get: http://the-internet.herokuapp.com]\n Done: [click: 23 [[FirefoxDriver: firefox on MAC (2afa5f83-1aba-ad43-b1f3-9b4907ae9471)] -> css selector: a]]\n")),(0,a.kt)("p",null,"If we couple this with jQuery Growl Notifications (",(0,a.kt)("a",{parentName:"p",href:"https://elementalselenium.com/docs/growl/53-growl"},"covered in the last tip"),")\nthen we can really put this information to work."),(0,a.kt)("p",null,"Let's add some helper methods to add jQuery Growl to the page and display notification messages."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ruby"},"def add_growl_notifications\n  @driver.execute_script(\"if (!window.jQuery) {\n      var jquery = document.createElement('script'); jquery.type = 'text/javascript';\n      jquery.src = 'https://ajax.googleapis.com/ajax/libs/jquery/2.0.2/jquery.min.js';\n      document.getElementsByTagName('head')[0].appendChild(jquery);\n    }\")\n\n  @driver.execute_script(\"$.getScript('http://the-internet.herokuapp.com/js/vendor/jquery.growl.js')\")\n\n  @driver.execute_script(\"$('head').append('<link rel=\\\"stylesheet\\\" href=\\\"http://the-internet.herokuapp.com/css/jquery.growl.css\\\" type=\\\"text/css\\\" />');\")\nend\n\ndef display_growl_message(message)\n  @driver.execute_script(\"$.growl({ title: 'Selenium', message: '#{message}' });\")\n  sleep 2\nend\n")),(0,a.kt)("p",null,"Now let's update our test to perform an action and then display it through jQuery Growl notifications."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ruby"},"run do\n  @driver.get 'http://the-internet.herokuapp.com'\n  add_growl_notifications\n  display_growl_message(@logger.latest)\nend\n")),(0,a.kt)("p",null,"When we run this (e.g., ",(0,a.kt)("inlineCode",{parentName:"p"},"ruby log_test.rb"),"), we should see the latest log action appear in a growl notification within\nthe browser window."),(0,a.kt)("h2",{id:"expected-behavior"},"Expected Behavior"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Load the browser"),(0,a.kt)("li",{parentName:"ul"},"Take an action"),(0,a.kt)("li",{parentName:"ul"},"Grab the action from the logs"),(0,a.kt)("li",{parentName:"ul"},"Display the action")),(0,a.kt)("h2",{id:"summary"},"Summary"),(0,a.kt)("p",null,"Hopefully that was a helpful tip on how to get browser-agnostic, real-time logging information."),(0,a.kt)("p",null,"Happy Testing!"),(0,a.kt)("h2",{id:"about-the-author"},"About The Author"),(0,a.kt)("p",null,"Dave Haeffner is the original writer of Elemental Selenium -- a free, once weekly Selenium tip newsletter that's\nread by thousands of testing professionals. He also created and maintains the-internet (an open-source web app that's\nperfect for writing automated tests against)."),(0,a.kt)("p",null,"Dave has helped numerous companies successfully implement automated acceptance testing; including The Motley Fool,\nManTech International, Sittercity, and Animoto. He is also an active member of the Selenium project and has spoken at\nnumerous conferences and meetups around the world about automated acceptance testing."))}d.isMDXComponent=!0}}]);